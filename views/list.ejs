<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet">
</head>
<body class="grey-bg">
    <%- include('nav.ejs') %>
    <!-- ì´ë ‡ê²Œ ì“°ë©´ ë°ì´í„° í™•ì¸ ê°€ëŠ¥ -->
    <!-- <%= JSON.stringify(posts) %>  -->
    <div class="white-bg">
        <% for( let i = 0; i < posts.length; i++){ %>
            <div class="list-box">
                <h4>
                    <a href="/detail/<%= posts[i]._id %>">
                        <%= posts[i].title %>
                    </a>
                </h4>
                <p><%= posts[i].content %></p>
                <a href="/edit/<%= posts[i]._id %>">
                    ìˆ˜ì •í•˜ê¸°
                </a>
                <button class="delete01">
                    ğŸ—‘ï¸
                </button>
                <button class="delete02">
                    ğŸ—‘ï¸ğŸ—‘ï¸
                </button>
                <button class="delete03" data-id="<%= posts[i]._id %>">
                    ğŸ—‘ï¸ğŸ—‘ï¸ğŸ—‘ï¸
                </button>
            </div>
        <% } %>
    </div> 
    <script>
        // URL parameterë¥¼ ì´ìš©í•´ ì„œë²„ë¡œ ë°ì´í„° ë‚ ë¦¬ê¸°
        document.getElementsByClassName('delete01')[0].addEventListener('click', function(){
            console.log('delete 01 ë²„íŠ¼í´ë¦­');

            fetch('/delete01', {    // ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì„œë²„ë¡œ ìš”ì²­ ë³´ëƒ„
                method : 'POST',
                headers : {
                    'Content-Type' : 'application/json'
                },
                body : JSON.stringify({result : 1}) // Object/arrayë¥¼ JSONìœ¼ë¡œ ë°”ê¿”ì¤Œ
            }) 
        })

        // URL parameterë¥¼ ì´ìš©í•´ ì„œë²„ë¡œ ë°ì´í„° ë‚ ë¦¬ê¸°02
        document.getElementsByClassName('delete02')[0].addEventListener('click', function(){
            console.log('delete 02 ë²„íŠ¼í´ë¦­');
            fetch('/delete02/suyoung', {
            }) 
        })        

        // query stringì„ ì´ìš©í•´ ì„œë²„ë¡œ ë°ì´í„° ë‚ ë¦¬ê¸°, URLì´ ë³´ì´ëŠ”ê²Œ ë‹¨ì 
        // document.querySelectorAll('.delete03')[0].addEventListener('click', function(){
        //     console.log('delete 03 ë²„íŠ¼í´ë¦­');
        //     console.log('<%= posts[0]._id %>');

        //     fetch(`/delete03?postId=<%= posts[0]._id %>&name=Jung`) 
        //     // fetch('/abc?ë°ì´í„°ì´ë¦„=ë°ì´í„°ê°’ -> /abcë¡œ ìš”ì²­ë³´ë‚´ë©´, ë°ì´í„°ê°’ì„ ë°ì´í„°ì´ë¦„ìœ¼ë¡œ ë³´ë‚´ì¤Œ
        // })

        let delete03Array = document.querySelectorAll('.delete03');
        delete03Array.forEach(function (button) {
            button.addEventListener('click', function (e) {
                console.log('delete 03 ë²„íŠ¼ í´ë¦­');
                console.log('posts.length:', '<%= posts.length %>'); // EJS ë Œë”ë§ ê°’ í™•ì¸
                fetch('/delete03?postId=' + e.target.dataset.id + '&name=Jung', {
                    // method : 'DELETE',
                })
                // .then((r)=>{
                //     if(r.status == 200) {
                //         return r.json()
                //     } else {
                //     //ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œì „ì†¡ì‹œ ì‹¤í–‰í• ì½”ë“œ
                //     }
                // })
                .then((r)=>{
                    // ëˆ„ë¥¸ ë²„íŠ¼ì˜ ìƒìœ„ìš”ì†Œ ì•ˆë³´ì´ê²Œ
                    e.target.parentElement.style.display = 'none';
                })
                .catch((error)=>{
                    //ì¸í„°ë„·ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í• ì½”ë“œ
                    console.log(error)
                })
            });
        });
        
        

    </script>
  </body>
</html>